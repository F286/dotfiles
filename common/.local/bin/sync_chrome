#!/usr/bin/env bash
set -euo pipefail

# Navigate to Chrome directory
cd ~/chrome/src/

# Update
git rebase-update
gclient sync -D

# Rebuild zoekt index
si

# Optimize git
echo "Updating commit-graph..."
git commit-graph write --reachable
echo "Updating multi-pack index..."
git multi-pack-index write
echo "Running aggressive garbage collection..."
# git gc --aggressive --prune=now
git gc --prune=now

# Build
gn gen out/Default
autoninja -C out/Default
