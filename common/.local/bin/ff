#!/usr/bin/env bash
set -euo pipefail

# Build args as an array so quoting stays correct.
ADDITIONAL_ARGS=(--bind "enter:become(nvim {1})")

if [[ "${1:-}" == "--code" ]]; then
  ADDITIONAL_ARGS=(
    --bind "enter:execute-silent(code -r -g {1}:{2})"
    --bind "esc:clear-query"
  )
fi

exec fzf \
  --tiebreak=pathname \
  --delimiter : \
  --preview 'bat --style=numbers --color=always --line-range :500 {}' \
  --preview-window 'right,55%' \
  "${ADDITIONAL_ARGS[@]}"
