#!/usr/bin/env bash
set -e

# Use sudo only if not running as root
if [ "$(id -u)" -eq 0 ]; then
    SUDO=""
else
    SUDO="sudo"
fi

COMMON_APPS=(
{{ include "common_apps.txt" | split "\n" | join "\n    " }}
)

echo "Running Linux setup using apt..."
if command -v apt-get >/dev/null 2>&1; then
    $SUDO apt-get update -y -qq || true
    for pkg in "${COMMON_APPS[@]}"; do
        apt_pkg="$pkg"
        [ "$pkg" = "fd" ] && apt_pkg="fd-find"
        [ "$pkg" = "nvim" ] && apt_pkg="neovim"
        $SUDO apt-get install -y "$apt_pkg" || true
    done
    # Install fonts (Linux-specific: fonts-firacode)
    $SUDO apt-get install -y fonts-firacode || true
else
    echo "apt-get not found. Skipping package installs."
fi

echo "Linux setup complete!"
