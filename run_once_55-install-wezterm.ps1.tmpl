# Idempotent winget install on first apply
$ErrorActionPreference = "Stop"

if (Get-Command wezterm -ErrorAction SilentlyContinue) {
  Write-Host "wezterm already installed: $(wezterm -V 2>$null)"
  exit 0
}

if (-not (Get-Command winget -ErrorAction SilentlyContinue)) {
  Write-Host "winget not found. Install App Installer from Microsoft Store, then re-run chezmoi."
  exit 0
}

$pkg = winget list --id wez.wezterm -e
if ($LASTEXITCODE -eq 0 -and $pkg) {
  Write-Host "wezterm present via winget."
} else {
  winget install --id wez.wezterm -e --accept-package-agreements --accept-source-agreements
}
