{{ if eq .chezmoi.os "windows" -}}
$ErrorActionPreference = 'Stop'

# Install Neovim if missing
if (-not (Get-Command nvim -ErrorAction SilentlyContinue)) {
    if (Get-Command winget -ErrorAction SilentlyContinue) {
        winget install --id Neovim.Neovim -e --source winget
    } elseif (Get-Command scoop -ErrorAction SilentlyContinue) {
        scoop install neovim
    } else {
        Write-Host "No supported package manager found for Neovim installation."
    }
}

# Replace existing configuration with LazyVim starter
$ConfigDir = Join-Path $env:LOCALAPPDATA 'nvim'
if (Test-Path $ConfigDir) {
    Remove-Item $ConfigDir -Recurse -Force
}

git clone https://github.com/LazyVim/starter $ConfigDir
Remove-Item (Join-Path $ConfigDir '.git') -Recurse -Force
{{ end -}}
