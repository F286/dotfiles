{{ if ne .chezmoi.os "windows" -}}
#!/usr/bin/env bash
set -euo pipefail

# If bat is available, nothing to do.
if command -v bat >/dev/null 2>&1; then
  exit 0
fi

# On Debian/Ubuntu, the binary may be named batcat. If present, ensure a user-level symlink.
if command -v batcat >/dev/null 2>&1; then
  mkdir -p "$HOME/.local/bin"
  if [ ! -e "$HOME/.local/bin/bat" ]; then
    ln -s "$(command -v batcat)" "$HOME/.local/bin/bat"
  fi
  exit 0
fi

# Install via available package manager
if command -v brew >/dev/null 2>&1; then
  brew install bat
elif command -v apt-get >/dev/null 2>&1; then
  sudo apt-get update -y
  sudo apt-get install -y bat || true
  # Provide a symlink to bat if only batcat exists
  if ! command -v bat >/dev/null 2>&1 && command -v batcat >/dev/null 2>&1; then
    mkdir -p "$HOME/.local/bin"
    if [ ! -e "$HOME/.local/bin/bat" ]; then
      ln -s "$(command -v batcat)" "$HOME/.local/bin/bat"
    fi
  fi
elif command -v dnf >/dev/null 2>&1; then
  sudo dnf install -y bat
elif command -v pacman >/dev/null 2>&1; then
  sudo pacman -Sy --noconfirm bat
elif command -v zypper >/dev/null 2>&1; then
  sudo zypper refresh
  sudo zypper install -y bat
elif command -v apk >/dev/null 2>&1; then
  sudo apk add --no-cache bat
else
  echo "No supported package manager found. Install bat manually."
  exit 0
fi

# Post-install: if only batcat is present (Debian/Ubuntu), create a user-level symlink.
if ! command -v bat >/dev/null 2>&1 && command -v batcat >/dev/null 2>&1; then
  mkdir -p "$HOME/.local/bin"
  if [ ! -e "$HOME/.local/bin/bat" ]; then
    ln -s "$(command -v batcat)" "$HOME/.local/bin/bat"
  fi
fi
{{ end -}}
